<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mini Meet</title>
  <link rel="stylesheet" href="style.css" />
  <!-- QRCode library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body class="centered theme-dark">
  <div class="card">
    <div class="card-header">
      <h1>Mini Meet</h1>
      <button id="themeToggle" class="pill-btn">ðŸŒ— Theme</button>
    </div>
    <p>Create or join a secure video meeting.</p>

    <div class="block">
      <input type="text" id="nameInput" placeholder="Your name (optional)" />
    </div>

    <div class="block">
      <button id="createRoomBtn" class="primary-btn">Create New Room</button>
    </div>

    <div class="block">
      <input type="text" id="roomIdInput" placeholder="Enter Room ID" />
    </div>

    <div class="block">
      <input type="password" id="roomPwdInput" placeholder="Room password (if any)" />
    </div>

    <div class="block">
      <button id="joinRoomBtn" class="pill-btn">Join Room</button>
    </div>

    <small id="roomHint"></small>

    <div id="shareSection" class="share-section hidden">
      <h3>Share this room</h3>
      <div id="qrContainer"></div>
      <div class="share-buttons">
        <button id="shareWhatsApp" class="pill-btn">Share on WhatsApp</button>
        <button id="shareEmail" class="pill-btn">Share by Email</button>
      </div>
    </div>
  </div>

  <script>
    const themeToggle = document.getElementById("themeToggle");
    const createBtn = document.getElementById("createRoomBtn");
    const joinBtn = document.getElementById("joinRoomBtn");
    const roomInput = document.getElementById("roomIdInput");
    const pwdInput = document.getElementById("roomPwdInput");
    const nameInput = document.getElementById("nameInput");
    const roomHint = document.getElementById("roomHint");
    const shareSection = document.getElementById("shareSection");
    const shareWhatsApp = document.getElementById("shareWhatsApp");
    const shareEmail = document.getElementById("shareEmail");

    let lastRoomUrl = "";

    function generateRoomId() {
      const rand = Math.random().toString(36).substring(2, 8);
      const ts = Date.now().toString(36).substring(4);
      return `meet-${rand}${ts}`;
    }

    function buildRoomUrl(roomId, pwd, name, isHost) {
      const params = new URLSearchParams();
      params.set("room", roomId);
      if (pwd) params.set("pwd", pwd);
      if (name) params.set("name", name);
      if (isHost) params.set("host", "1");
      return `${window.location.origin}/room.html?${params.toString()}`;
    }

    function showQR(url) {
      shareSection.classList.remove("hidden");
      const container = document.getElementById("qrContainer");
      container.innerHTML = "";
      new QRCode(container, {
        text: url,
        width: 160,
        height: 160,
      });
    }

    themeToggle.addEventListener("click", () => {
      document.body.classList.toggle("theme-dark");
      document.body.classList.toggle("theme-light");
    });

    createBtn.addEventListener("click", () => {
      const roomId = generateRoomId();
      const pwd = prompt("Set a room password (optional, can be empty):") || "";
      const name = nameInput.value.trim();

      const url = buildRoomUrl(roomId, pwd, name, true);
      lastRoomUrl = url;
      roomHint.textContent = "Room created: " + roomId;
      showQR(url);

      // Open room as host
      window.location.href = url;
    });

    joinBtn.addEventListener("click", () => {
      const roomId = roomInput.value.trim();
      const pwd = pwdInput.value.trim();
      const name = nameInput.value.trim();

      if (!roomId) {
        alert("Enter a room ID.");
        return;
      }

      const params = new URLSearchParams();
      params.set("room", roomId);
      if (pwd) params.set("pwd", pwd);
      if (name) params.set("name", name);
      params.set("host", "0");

      const url = `${window.location.origin}/room.html?${params.toString()}`;
      lastRoomUrl = url;
      window.location.href = url;
    });

    shareWhatsApp.addEventListener("click", () => {
      if (!lastRoomUrl) return;
      const text = `Join my Mini Meet: ${lastRoomUrl}`;
      window.open("https://wa.me/?text=" + encodeURIComponent(text), "_blank");
    });

    shareEmail.addEventListener("click", () => {
      if (!lastRoomUrl) return;
      const subject = "Join my Mini Meet";
      const body = "Here is the meeting link: " + lastRoomUrl;
      window.location.href =
        "mailto:?subject=" +
        encodeURIComponent(subject) +
        "&body=" +
        encodeURIComponent(body);
    });
  </script>
</body>
</html>
